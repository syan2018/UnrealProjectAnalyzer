---
globs: "*.cpp,*.h,*.cs"
---

# UE5 插件开发规范

## 插件结构

```
unreal-plugin/
├── UE5ProjectAnalyzer.uplugin    # 插件描述文件
├── Source/UE5ProjectAnalyzer/
│   ├── Public/                   # 头文件
│   ├── Private/                  # 实现文件
│   └── UE5ProjectAnalyzer.Build.cs
└── Content/Python/               # Python Bridge 脚本
```

## 模块职责

| 文件 | 职责 |
|------|------|
| `UE5ProjectAnalyzer.cpp/h` | 模块入口，HTTP Server 初始化 |
| `BlueprintAnalyzer.cpp/h` | Blueprint 分析逻辑 |
| `AssetAnalyzer.cpp/h` | Asset 引用分析逻辑 |
| `HttpRoutes.cpp/h` | HTTP 路由注册 |

## HTTP API 设计

### Blueprint API

```
GET /blueprint/search?pattern=xxx&class=xxx
GET /blueprint/{path}/hierarchy
GET /blueprint/{path}/dependencies
GET /blueprint/{path}/referencers
GET /blueprint/{path}/graph/{graph_name}
GET /blueprint/{path}/details
```

### Asset API

```
GET /asset/search?pattern=xxx&type=xxx
GET /asset/{path}/references
GET /asset/{path}/referencers
GET /asset/{path}/metadata
```

### Analysis API

```
GET /analysis/reference-chain?start=xxx&depth=xxx
GET /analysis/cpp-class-usage?class=xxx
```

## 编码规范

### 命名

- 类: `F` 前缀 (struct), `U` 前缀 (UObject), `A` 前缀 (Actor)
- 模块类: `FUE5ProjectAnalyzerModule`
- 布尔值: `b` 前缀 (`bIsEnabled`)

### 日志

```cpp
UE_LOG(LogTemp, Log, TEXT("UE5ProjectAnalyzer: Message"));
UE_LOG(LogTemp, Warning, TEXT("UE5ProjectAnalyzer: Warning"));
UE_LOG(LogTemp, Error, TEXT("UE5ProjectAnalyzer: Error"));
```

### HTTP 路由注册

```cpp
Router->BindRoute(
    FHttpPath(TEXT("/endpoint")),
    EHttpServerRequestVerbs::VERB_GET,
    [](const FHttpServerRequest& Request, const FHttpResultCallback& OnComplete)
    {
        // 处理请求
        TUniquePtr<FHttpServerResponse> Response = FHttpServerResponse::Create(
            TEXT("{\"key\": \"value\"}"),
            TEXT("application/json")
        );
        OnComplete(MoveTemp(Response));
        return true;
    }
);
```

## Python Bridge

Python Bridge 通过 `PythonScriptPlugin` 在模块启动时自动拉起：

```cpp
// 在 StartupModule() 中
IPythonScriptPlugin* PythonPlugin = FModuleManager::GetModulePtr<IPythonScriptPlugin>("PythonScriptPlugin");
PythonPlugin->ExecPythonCommand(*PythonCommand);
```

## 依赖模块

必需的 UE 模块 (在 Build.cs 中声明)：
- `HTTP`, `HTTPServer` - HTTP 服务
- `Json`, `JsonUtilities` - JSON 处理
- `UnrealEd`, `BlueprintGraph`, `Kismet` - 蓝图 API
- `AssetRegistry` - 资产引用 API
- `PythonScriptPlugin` - Python 集成
